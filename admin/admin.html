<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlexConsole Admin</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <style>
      :root {
        --primary-color: #3e5bff;
        --secondary-color: #1d3be6;
        --background-color: #343541;
        --card-bg: #444654;
        --text-color: #ffffff;
        --border-color: #565869;
        --hover-color: #2a2b32;
        --shadow-color: rgba(0, 0, 0, 0.2);
      }

      body {
        background-color: var(--background-color);
        color: var(--text-color);
      }

      .neon-button {
        position: relative;
        background: var(--hover-color);
        border: 2px solid var(--primary-color);
        border-radius: 8px;
        color: var(--primary-color);
        padding: 0.75rem 2rem;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        transition: all 0.3s;
        overflow: hidden;
      }

      .neon-button:hover {
        background: var(--primary-color);
        color: var(--dark-bg);
        box-shadow: 0 0 25px var(--primary-color);
      }

      .card {
        background: var(--hover-color);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 1.5rem;
        transition: transform 0.3s;
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .category-card {
        cursor: pointer;
        transition: all 0.3s;
      }

      .category-card.selected {
        border-color: var(--primary-color);
        box-shadow: 0 0 15px var(--primary-color);
      }

      .modal {
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(8px);
        transition: all 0.3s ease-in-out;
        overflow-y: auto;
        max-height: 105vh;
        scrollbar-width: none;
      }

      .modal-content {
        background: linear-gradient(145deg, #0f1729, #1a1f35);
        border: 1px solid var(--primary-color);
        box-shadow: 0 0 25px rgba(50, 54, 54, 0.1);
        transform: scale(0.95);
        opacity: 0;
        transition: all 0.3s ease-in-out;
        max-height: calc(90vh - 40px); /* Menyesuaikan tinggi konten */
        overflow-y: auto; /* Mengaktifkan scroll pada konten */
        scrollbar-width: none;
      }

      .modal.show .modal-content {
        transform: scale(1);
        opacity: 1;
      }

      .modal-content {
        border-radius: 1rem;
        max-width: 90vw;
        padding: 2rem;
        margin: 2rem;
      }

      #appList {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 2rem;
        padding: 1rem;
      }

      #appListModal {
        z-index: 50;
      }

      #appModal {
        z-index: 51; /* Higher than appListModal */
      }

      #helpModal {
        z-index: 52;
      }

      .card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        border-color: var(--primary-color);
        box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
      }

      .input-group {
        position: relative;
        margin-bottom: 1.5rem;
      }

      .input-group label {
        position: absolute;
        left: 1rem;
        top: 0.75rem;
        color: var(--light-blue);
        transition: all 0.2s ease-in-out;
        pointer-events: none;
        font-size: 0.875rem;
      }

      .input-group input:focus ~ label,
      .input-group input:not(:placeholder-shown) ~ label,
      .input-group textarea:focus ~ label,
      .input-group textarea:not(:placeholder-shown) ~ label {
        top: -0.5rem;
        left: 0.75rem;
        font-size: 0.75rem;
        padding: 0 0.25rem;
        background: #1a1f35;
        color: var(--primary-color);
      }

      .input-group input,
      .input-group textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        color: var(--light-blue);
        transition: all 0.2s;
      }

      .input-group input:focus,
      .input-group textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
      }

      .category-card {
        padding: 1rem;
        text-align: center;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.5rem;
        transition: all 0.3s;
      }

      .category-card.selected {
        background: rgba(0, 243, 255, 0.1);
        border-color: var(--primary-color);
        box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
      }

      .modal-header {
        position: relative;
        padding-bottom: 1rem;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .modal-close {
        position: absolute;
        top: 0;
        right: 0;
        padding: 0.5rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .modal-close:hover {
        color: var(--primary-color);
      }

      nav h1 {
        top: 50px;
      }

      /* Mobile menu adjustments */
      @media (max-width: 768px) {
        nav .container {
          padding: 0.5rem 1rem;
        }

        nav h1 {
          font-size: 1.25rem;
        }

        nav .flex.items-center.space-x-4 {
          gap: 0.5rem;
        }

        nav .neon-button {
          padding: 0.4rem 0.75rem;
          font-size: 0.75rem;
        }

        nav .neon-button svg {
          width: 1rem;
          height: 1rem;
        }

        nav h1 {
          font-size: 1.25rem;
          margin-bottom: 0;
        }
      }

      /* Hide button text on very small screens */
      @media (max-width: 480px) {
        nav .neon-button span {
          display: none;
        }

        nav h1 {
          font-size: 0.01rem;
          margin-bottom: 0;
        }

        nav .neon-button {
          padding: 0.5rem;
        }

        nav .neon-button svg {
          margin: 0;
        }
      }
    </style>
  </head>
  <body class="min-h-screen">
    <!-- Navbar -->
    <nav
      class="fixed top-0 w-full bg-black bg-opacity-10 backdrop-filter backdrop-blur-lg z-50 border-b border-blue-400"
    >
      <div
        class="container mx-auto px-6 py-3 flex justify-between items-center"
      >
        <div class="flex items-center">
          <img
            src="https://forum.obsidian.md/uploads/default/original/2X/6/6df43bc4ee96f0a1b67ff3600caf6879b758a743.png"
            alt="FlexConsole Logo"
            class="h-10"
          />
          <h1 class="text-2xl font-bold my-auto ml-2">FlexConsole</h1>
        </div>
        <div class="flex items-center space-x-4">
          <button
            onclick="window.location.href='../../index.html'"
            class="neon-button flex items-center space-x-2"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
              />
            </svg>
            <span>Go to FlexPortal</span>
          </button>
          <button
            onclick="handleLogout()"
            class="neon-button flex items-center space-x-2"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
              />
            </svg>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <main class="container mx-auto px-6 pt-24 pb-12">
      <div class="animate__animated animate__fadeIn text-center my-12">
        <h1 class="text-4xl font-bold mb-4">Welcome to FlexConsole</h1>
        <p class="text-xl text-blue-300">
          Manage your apps portfolio with style
        </p>
      </div>

      <!-- Action Buttons -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12">
        <button
          onclick="showAddAppModal()"
          class="card neon-button flex items-center justify-center space-x-2"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 6v6m0 0v6m0-6h6m-6 0H6"
            />
          </svg>
          <span>Add New App</span>
        </button>
        <button
          onclick="showAppList()"
          class="card neon-button flex items-center justify-center space-x-2"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 10h16M4 14h16M4 18h16"
            />
          </svg>
          <span>View App List</span>
        </button>
        <button
          onclick="showHelpModal()"
          class="card neon-button flex items-center justify-center space-x-2"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span>Help Guide</span>
        </button>
      </div>

      <!-- Statistics -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
        <div class="card">
          <h3 class="text-xl font-bold mb-4">Apps by Category</h3>
          <canvas id="categoryChart"></canvas>
        </div>
        <div class="card">
          <h3 class="text-xl font-bold mb-4">Pricing Distribution</h3>
          <canvas id="pricingChart"></canvas>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-black bg-opacity-90 py-6">
      <div class="container mx-auto px-6 text-center">
        <p>&copy; 2024 FlexConsole. All rights reserved.</p>
      </div>
    </footer>

    <!-- Add/Edit App Modal -->
    <div
      id="appModal"
      class="modal fixed inset-0 hidden flex items-center justify-center"
    >
      <div class="modal-content w-full max-w-2xl p-6 rounded-lg">
        <div class="modal-header">
          <h2 id="modalTitle" class="text-2xl font-bold">Add New App</h2>
          <button onclick="hideModal('appModal')" class="modal-close">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <form id="appForm" class="space-y-6">
          <div class="input-group">
            <input type="text" id="appName" required placeholder=" " />
            <label for="appName">Application Name</label>
          </div>

          <div class="space-y-2">
            <label class="block text-sm font-medium text-blue-300"
              >Category</label
            >
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
              <div class="category-card" data-category="games">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"
                  ></path>
                </svg>
                Games
              </div>

              <div class="category-card" data-category="school">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 14l9-5-9-5-9 5 9 5z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 14l9-5-9-5-9 5 9 5z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 14v7"
                  />
                </svg>
                School
              </div>

              <div class="category-card" data-category="productivity">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                  />
                </svg>
                Productivity
              </div>

              <div class="category-card" data-category="business">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  />
                </svg>
                Business
              </div>

              <div class="category-card" data-category="ai-tools">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                  />
                </svg>
                AI Tools
              </div>
            </div>
            <p id="categoryError" class="hidden text-red-400 text-xs mt-1">
              Please select a category
            </p>
          </div>

          <div class="space-y-2">
            <label class="block text-sm font-medium text-blue-300"
              >Pricing Model</label
            >
            <div class="grid grid-cols-2 gap-3">
              <div class="category-card" data-pricing="full-free">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                Full Free
              </div>

              <div class="category-card" data-pricing="free-credits">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                Free Credits
              </div>

              <div class="category-card" data-pricing="free-limits">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                  />
                </svg>
                Free Limits
              </div>

              <div class="category-card" data-pricing="paid">
                <svg
                  class="w-6 h-6 mx-auto mb-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"
                  />
                </svg>
                Paid
              </div>
            </div>
            <p id="pricingError" class="hidden text-red-400 text-xs mt-1">
              Please select a pricing model
            </p>
          </div>

          <div class="input-group">
            <textarea
              id="appDescription"
              required
              rows="4"
              placeholder=" "
            ></textarea>
            <label for="appDescription">Description</label>
          </div>

          <div class="input-group">
            <textarea
              id="appThumbnails"
              required
              rows="3"
              placeholder=" "
            ></textarea>
            <label for="appThumbnails"
              >Thumbnail URLs (One per line, max 3)</label
            >
          </div>

          <div class="input-group">
            <input type="url" id="appIcon" required placeholder=" " />
            <label for="appIcon">App Icon URL</label>
          </div>

          <div class="input-group">
            <input type="url" id="appLink" required placeholder=" " />
            <label for="appLink">Application Link</label>
          </div>

          <div class="flex justify-end space-x-4 pt-4 border-t border-gray-700">
            <button
              type="button"
              onclick="hideModal('appModal')"
              class="neon-button"
            >
              Cancel
            </button>
            <button type="submit" class="neon-button">Save Application</button>
          </div>
        </form>
      </div>
    </div>

    <!-- App List Modal -->
    <div
      id="appListModal"
      class="modal fixed inset-0 hidden flex items-center justify-center"
    >
      <div class="modal-content w-full max-w-4xl p-6 rounded-lg">
        <div class="modal-header">
          <h2 class="text-2xl font-bold">App List</h2>
          <button onclick="hideModal('appListModal')" class="modal-close">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div
          id="appList"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
          <!-- Apps will be populated here -->
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div
      id="helpModal"
      class="modal fixed inset-0 hidden z-50 flex items-center justify-center"
    >
      <div class="modal-content w-full max-w-2xl p-6 rounded-lg">
        <h2 class="text-2xl font-bold mb-4">Help Guide</h2>
        <div class="space-y-4">
          <div>
            <h3 class="text-xl font-bold">Adding New Apps</h3>
            <p>
              Click the "Add New App" button and fill in all required fields.
              You can add up to 3 thumbnail URLs.
            </p>
          </div>
          <div>
            <h3 class="text-xl font-bold">Viewing Apps</h3>
            <p>
              Click "View App List" to see all apps. You can edit or remove apps
              from this view.
            </p>
          </div>
          <div>
            <h3 class="text-xl font-bold">Navigation</h3>
            <p>
              Use "Go to FlexPortal" to visit the main portal or "Logout" to end
              your session.
            </p>
          </div>
        </div>
        <button onclick="hideModal('helpModal')" class="neon-button mt-6">
          Close
        </button>
      </div>
    </div>

    <script>
      const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL;
const SUPABASE_ANON_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);


      // Database functions
      async function addApp(appData) {
        const { data, error } = await supabaseClient
          .from("apps")
          .insert([appData]);
        if (error) throw error;
        return data;
      }

      async function updateApp(id, appData) {
        const { data, error } = await supabaseClient
          .from("apps")
          .update(appData)
          .match({ id });
        if (error) throw error;
        return data;
      }

      async function deleteApp(id) {
        const { error } = await supabaseClient
          .from("apps")
          .delete()
          .match({ id });
        if (error) throw error;
      }

      async function loadApps() {
        const { data, error } = await supabaseClient.from("apps").select("*");
        if (error) throw error;
        return data;
      }
    </script>
    <script>
      // Check authentication
      if (!localStorage.getItem("isVerified")) {
        window.location.href = "verify.html";
      }

      // Initialize variables
      let selectedCategory = "";
      let selectedPricing = "";
      let currentEditId = null;
      let categoryChart = null;
      let pricingChart = null;

      function showAddAppModal() {
        currentEditId = null;
        document.getElementById("modalTitle").textContent = "Add New App";
        resetForm();
        showModal("appModal");
      }

      // Update showEditModal function
      function showEditModal(app) {
        // Hide appListModal first
        document.getElementById("appListModal").classList.add("hidden");

        currentEditId = app.id;
        document.getElementById("modalTitle").textContent = "Edit App";
        document.getElementById("appName").value = app.name;
        document.getElementById("appDescription").value = app.description;
        document.getElementById("appThumbnails").value =
          app.thumbnails.join("\n");
        document.getElementById("appIcon").value = app.icon;
        document.getElementById("appLink").value = app.link;

        // Select category and pricing
        document.querySelectorAll(".category-card").forEach((card) => {
          if (
            card.dataset.category === app.category ||
            card.dataset.pricing === app.pricing
          ) {
            card.click();
          }
        });

        showModal("appModal");
      }

      async function showAppList() {
        try {
          const apps = await loadApps();
          renderAppList(apps);
          showModal("appListModal");
        } catch (error) {
          console.error("Error loading apps:", error);
          handleError(error);
        }
      }

      function showHelpModal() {
        showModal("helpModal");
      }

      // Apps list rendering
      function renderAppList(apps) {
        const appList = document.getElementById("appList");
        appList.innerHTML = apps
          .map(
            (app) => `
    <div class="card hover:shadow-xl">
      <div class="relative">
        <img src="${app.icon || app.thumbnails[0]}" 
             alt="${app.name}" 
             class="w-16 h-16 rounded-lg mb-4 mx-auto"
        />
        <img src="${app.thumbnails[0]}" 
             alt="${app.name}" 
             class="w-full h-48 object-cover rounded-lg mb-4"
        />
        <span class="absolute top-2 right-2 px-2 py-1 bg-opacity-75 bg-black rounded text-xs text-white">
          ${app.pricing}
        </span>
      </div>
      
      <div class="p-4">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-xl font-bold truncate">${app.name}</h3>
          <span class="px-2 py-1 text-xs rounded-full bg-blue-500 bg-opacity-25">
            ${app.category}
          </span>
        </div>
        
        <p class="text-sm text-gray-300 mb-4 line-clamp-2">
          ${app.description}
        </p>

        <div class="flex justify-between items-center pt-4 border-t border-gray-700">
          <a href="${app.link}" 
             target="_blank" 
             class="text-blue-400 hover:text-blue-300 text-sm">
            Visit Site â†’
          </a>
          
          <div class="flex space-x-2">
            <button onclick='showEditModal(${JSON.stringify(app).replace(
              /"/g,
              "&quot;"
            )})'
                    class="neon-button text-xs px-3 py-1">
              Edit
            </button>
            <button onclick="handleDeleteApp('${app.id}')"
                    class="neon-button text-xs px-3 py-1 bg-red-600 border-red-600">
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  `
          )
          .join("");
      }

      async function handleDeleteApp(id) {
        if (confirm("Are you sure you want to delete this app?")) {
          try {
            await deleteApp(id);
            const apps = await loadApps();
            renderAppList(apps);
            initializeCharts();

            // Show success toast
            const successToast = document.createElement("div");
            successToast.className =
              "fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate__animated animate__fadeIn";
            successToast.textContent = "App successfully deleted!";
            document.body.appendChild(successToast);

            setTimeout(() => {
              successToast.classList.remove("animate__fadeIn");
              successToast.classList.add("animate__fadeOut");
              setTimeout(() => successToast.remove(), 1000);
            }, 3000);
          } catch (error) {
            handleError(error);
          }
        }
      }

      // Authentication functions
      function handleLogout() {
        localStorage.removeItem("isVerified");
        window.location.href = "verify.html";
      }

      // Error handling
      function handleError(error) {
        console.error("Error:", error);
        alert("An error occurred. Please try again.");
      }
    </script>
    <script>
      // Add this JavaScript after your existing modal code

      document
        .getElementById("appForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          // Reset error messages
          document.getElementById("categoryError").classList.add("hidden");
          document.getElementById("pricingError").classList.add("hidden");

          // Validate selections
          if (!selectedCategory) {
            document.getElementById("categoryError").classList.remove("hidden");
            return;
          }
          if (!selectedPricing) {
            document.getElementById("pricingError").classList.remove("hidden");
            return;
          }

          const thumbnails = document
            .getElementById("appThumbnails")
            .value.split("\n")
            .filter((url) => url.trim())
            .slice(0, 3);

          // Validate thumbnails
          if (thumbnails.length === 0) {
            alert("Please provide at least one thumbnail URL");
            return;
          }

          // Prepare app data
          const appData = {
            name: document.getElementById("appName").value.trim(),
            category: selectedCategory,
            pricing: selectedPricing,
            description: document.getElementById("appDescription").value.trim(),
            thumbnails,
            icon: document.getElementById("appIcon").value.trim(), // Add icon
            link: document.getElementById("appLink").value.trim(),
          };

          try {
            // Show loading state
            const submitButton = e.target.querySelector(
              'button[type="submit"]'
            );
            const originalText = submitButton.innerText;
            submitButton.disabled = true;
            submitButton.innerText = "Saving...";

            if (currentEditId) {
              await updateApp(currentEditId, appData);
            } else {
              await addApp(appData);
            }

            // Show success message
            const successToast = document.createElement("div");
            successToast.className =
              "fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate__animated animate__fadeIn";
            successToast.textContent = `App successfully ${
              currentEditId ? "updated" : "added"
            }!`;
            document.body.appendChild(successToast);

            // Remove toast after 3 seconds
            setTimeout(() => {
              successToast.classList.remove("animate__fadeIn");
              successToast.classList.add("animate__fadeOut");
              setTimeout(() => successToast.remove(), 1000);
            }, 3000);

            // Reset and close modal
            hideModal("appModal");
            await loadApps();
            await initializeCharts();
          } catch (error) {
            // Show error message
            const errorToast = document.createElement("div");
            errorToast.className =
              "fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate__animated animate__fadeIn";
            errorToast.textContent =
              error.message || "Error saving app. Please try again.";
            document.body.appendChild(errorToast);

            setTimeout(() => {
              errorToast.classList.remove("animate__fadeIn");
              errorToast.classList.add("animate__fadeOut");
              setTimeout(() => errorToast.remove(), 1000);
            }, 3000);
          } finally {
            // Reset button state
            const submitButton = e.target.querySelector(
              'button[type="submit"]'
            );
            submitButton.disabled = false;
            submitButton.innerText = originalText;
          }
        });

      // Enhanced category and pricing selection with animation
      function setupCategoryCards() {
        document.querySelectorAll(".category-card").forEach((card) => {
          card.addEventListener("click", () => {
            const parent = card.parentElement;
            const isCategory = card.hasAttribute("data-category");

            // Remove selection from other cards
            parent.querySelectorAll(".category-card").forEach((c) => {
              c.classList.remove("selected");
              c.style.transform = "scale(1)";
            });

            // Add selection to clicked card
            card.classList.add("selected");
            card.style.transform = "scale(1.05)";

            // Update selected value
            if (isCategory) {
              selectedCategory = card.dataset.category;
              document.getElementById("categoryError").classList.add("hidden");
            } else {
              selectedPricing = card.dataset.pricing;
              document.getElementById("pricingError").classList.add("hidden");
            }

            // Add ripple effect
            const ripple = document.createElement("div");
            ripple.className =
              "absolute inset-0 bg-white bg-opacity-20 rounded-lg transform scale-0";
            card.appendChild(ripple);

            // Trigger animation
            requestAnimationFrame(() => {
              ripple.style.transform = "scale(1)";
              ripple.style.opacity = "0";
              setTimeout(() => ripple.remove(), 600);
            });
          });
        });
      }

      // Update resetForm function
      function resetForm() {
        const form = document.getElementById("appForm");
        form.reset();

        // Reset category and pricing selections with animation
        document.querySelectorAll(".category-card").forEach((card) => {
          card.classList.remove("selected");
          card.style.transform = "scale(1)";
        });

        // Reset error messages
        document.getElementById("categoryError").classList.add("hidden");
        document.getElementById("pricingError").classList.add("hidden");

        // Reset variables
        selectedCategory = "";
        selectedPricing = "";
        currentEditId = null;

        // Reset floating labels
        form
          .querySelectorAll(".input-group input, .input-group textarea")
          .forEach((input) => {
            const label = input.nextElementSibling;
            if (label) {
              label.style.transform = "translateY(0)";
            }
          });
      }

      // Enhanced modal transitions
      function showModal(modalId) {
        const modal = document.getElementById(modalId);
        document.body.style.overflow = "hidden";
        modal.classList.remove("hidden");
        requestAnimationFrame(() => {
          modal.classList.add("show");
          modal.querySelector(".modal-content").style.transform = "scale(1)";
          modal.querySelector(".modal-content").style.opacity = "1";
        });
      }

      function hideModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove("show");
        modal.querySelector(".modal-content").style.transform = "scale(0.95)";
        modal.querySelector(".modal-content").style.opacity = "0";

        setTimeout(() => {
          modal.classList.add("hidden");
          document.body.style.overflow = "";
          if (modalId === "appModal") {
            resetForm();
          }
        }, 300);
      }

      // Initialize floating labels
      function initializeFloatingLabels() {
        document
          .querySelectorAll(".input-group input, .input-group textarea")
          .forEach((input) => {
            input.addEventListener("focus", () => {
              const label = input.nextElementSibling;
              if (label) {
                label.style.transform = "translateY(-1.5rem) scale(0.75)";
                label.style.color = "var(--primary-color)";
              }
            });

            input.addEventListener("blur", () => {
              const label = input.nextElementSibling;
              if (label && !input.value) {
                label.style.transform = "translateY(0) scale(1)";
                label.style.color = "var(--light-blue)";
              }
            });

            // Check initial state
            if (input.value) {
              const label = input.nextElementSibling;
              if (label) {
                label.style.transform = "translateY(-1.5rem) scale(0.75)";
              }
            }
          });
      }

      async function initializeCharts() {
        try {
          const apps = await loadApps();

          // Destroy existing charts if they exist
          if (categoryChart) categoryChart.destroy();
          if (pricingChart) pricingChart.destroy();

          // Prepare data for category chart
          const categoryData = {
            games: 0,
            school: 0,
            productivity: 0,
            business: 0,
            "ai-tools": 0,
          };
          apps.forEach((app) => categoryData[app.category]++);

          // Create category chart
          const categoryCtx = document
            .getElementById("categoryChart")
            .getContext("2d");
          categoryChart = new Chart(categoryCtx, {
            type: "bar",
            data: {
              labels: Object.keys(categoryData),
              datasets: [
                {
                  label: "Apps per Category",
                  data: Object.values(categoryData),
                  backgroundColor: "rgba(0, 243, 255, 0.5)",
                  borderColor: "rgb(0, 243, 255)",
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    color: "#e6f3ff",
                  },
                },
                x: {
                  ticks: {
                    color: "#e6f3ff",
                  },
                },
              },
              plugins: {
                legend: {
                  labels: {
                    color: "#e6f3ff",
                  },
                },
              },
            },
          });

          // Prepare data for pricing chart
          const pricingData = {
            "full-free": 0,
            "free-credits": 0,
            "free-limits": 0,
            paid: 0,
          };
          apps.forEach((app) => pricingData[app.pricing]++);

          // Create pricing chart
          const pricingCtx = document
            .getElementById("pricingChart")
            .getContext("2d");
          pricingChart = new Chart(pricingCtx, {
            type: "pie",
            data: {
              labels: Object.keys(pricingData),
              datasets: [
                {
                  data: Object.values(pricingData),
                  backgroundColor: [
                    "rgba(0, 255, 255, 0.5)",
                    "rgba(0, 200, 255, 0.5)",
                    "rgba(0, 150, 255, 0.5)",
                    "rgba(0, 100, 255, 0.5)",
                  ],
                  borderColor: [
                    "rgb(0, 255, 255)",
                    "rgb(0, 200, 255)",
                    "rgb(0, 150, 255)",
                    "rgb(0, 100, 255)",
                  ],
                  borderWidth: 1,
                },
              ],
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  labels: {
                    color: "#e6f3ff",
                  },
                },
              },
            },
          });
        } catch (error) {
          console.error("Error initializing charts:", error);
        }
      }

      function setupAppForm() {
        // Your logic to set up the app form goes here
        console.log("setupAppForm is called");
        // Example:
        const appForm = document.getElementById("appForm"); // Assuming you have a form with this ID
        if (appForm) {
          appForm.addEventListener("submit", (event) => {
            event.preventDefault();
            // Handle form submission
            console.log("Form submitted");
          });
        }
      }

      // Initialize everything when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        initializeCharts();
        setupCategoryCards();
        initializeFloatingLabels();
        setupAppForm();
        loadApps();
      });
    </script>
  </body>
</html>
